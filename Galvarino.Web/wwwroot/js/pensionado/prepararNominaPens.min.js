window._ingresados=[];const eventos={pistolaDisparada:"snapshot.events.galvarino"},metodos={disparo:function(){var t=$("#folio-shot").val().substring(formatoFolios.codigo.inicio,formatoFolios.codigo.fin),n;const i={codigoTipoDocumento:t,folioCredito:$("#folio-shot").val().substring(formatoFolios.folioCredito.inicio,formatoFolios.folioCredito.fin),rutAfiliado:$("#folio-shot").val().substring(formatoFolios.rutAfiliado.inicio,formatoFolios.rutAfiliado.fin),completado:!1,documentos:[t],obtenido:{},pistoleado:[]};n=_ingresados.findIndex(function(n){return n.folioCredito==i.folioCredito});n>-1&&typeof _ingresados[n]!="undefined"&&_ingresados[n].documentos.indexOf(t)>-1?$.niftyNoty({type:"warning",container:"floating",title:"Operacion Expediente",message:"Documento ya pistoleado",closeBtn:!0,timer:5e3}):$(document).trigger(eventos.pistolaDisparada,i)},render:function(){$(".contenedor-folios").html("");$.each(_ingresados,function(n,t){let i=``;$.each(t.obtenido.documentos,function(n,r){let u=t.documentos.indexOf(r.codificacion)>-1?"glyphicon-ok":"glyphicon-remove";i+=`<li><a href="#">${enumTipoDocumentos[r.tipoDocumento]} <i class="glyphicon ${u}" /></a></li>`});let r=t.obtenido.documentos.length===t.documentos.length?"btn-success":"btn-warning",u=t.obtenido.documentos.length===t.documentos.length?!0:!1;t.completado=u;let f=`<div class="btn-group dropdown mar-rgt">
                <button class="btn ${r} dropdown-toggle dropdown-toggle-icon" data-toggle="dropdown" type="button" aria-expanded="false">
                    ${t.folioCredito} <i class="dropdown-caret"></i>
                </button>
                <ul class="dropdown-menu" style="">
                    ${i}
                </ul>
            </div>`;$(".contenedor-folios").append(f)})},avanzarWf:function(){let t=!0,n=[];if($.each(_ingresados,function(i,r){r.completado==!1&&(t=!1);r.obtenido.documentos.length===r.documentos.length&&n.push({FolioCredito:r.folioCredito})}),t==!1)return $.niftyNoty({type:"danger",container:"floating",title:"Error Preparar Nómina",message:"Debe Pistolear Todos los Documentos",closeBtn:!0,timer:5e3}),!1;if(n.length==0)return $.niftyNoty({type:"danger",container:"floating",title:"Error Preparar Nómina",message:"No puedes Generar una Nómina de Envío Sin Documentos",closeBtn:!1,timer:5e3}),!1;$.ajax({type:"POST",url:`/api/wf/v1/preparar-nomina`,data:JSON.stringify(n),contentType:"application/json; charset=utf-8"}).done(function(){$.niftyNoty({type:"success",container:"floating",title:"Despacho a Notaría",message:"Estamos Generando la Nómina...<br/><small>Esta Tarea se cierra en 5 Seg. y te redirige a tus solicitudes.<\/small>",closeBtn:!0,timer:5e3,onHidden:function(){location.href="/wf/v1/mis-solicitudes"}})}).fail(function(){$.niftyNoty({type:"warning",container:"floating",title:"Avance Tareas",message:"Tarea No Finalizada, contacte a Soporte!",closeBtn:!0,timer:5e3})}).always(function(){_ingresados=[];$("#modal-pistoleo").modal("hide");$("#tabla-generica").bootstrapTable("refresh")})}};$(function(){$(document).on(eventos.pistolaDisparada,function(n,t){let i=t,r=$("#etapa-actual").val();$.ajax({type:"GET",url:`/api/wf/v1/obtener-expediente/${i.folioCredito}/${r}`}).done(function(n){i.obtenido=n;let t=_ingresados.findIndex(function(n){return n.folioCredito==i.folioCredito});t>-1&&typeof _ingresados[t]!="undefined"&&i.folioCredito===_ingresados[t].folioCredito?_ingresados[t].documentos.indexOf(i.codigoTipoDocumento)<0&&_ingresados[t].documentos.push(i.codigoTipoDocumento):i.obtenido.id>0&&_ingresados.push(i);$("#folio-shot").val("");metodos.render()}).fail(function(n){console.log(n);$.niftyNoty({type:"danger",container:"floating",title:"Error al Pistolear:  "+$("#folio-shot").val(),message:n.responseText,closeBtn:!0,timer:5e3});$("#folio-shot").val("")})});$("#modal-pistoleo").on("shown.bs.modal",function(){$("#folio-shot").focus()});$("#modal-pistoleo").on("hidden.bs.modal",function(){$("#folio-shot").val("");_ingresados=[];metodos.render()});$("#frm-pistoleo").on("submit",function(n){n.preventDefault();metodos.disparo()});$("#btn-generar-generico").on("click",function(){metodos.avanzarWf()});$("#btn-exportar-excel").on("click",function(){var t=$("#tabla-generica tr").find("td:first").html(),n;t=="No matching records found"?$.niftyNoty({type:"warning",container:"floating",title:"Generar Excel",message:"No puede generar excel, no existen datos a cargar!",closeBtn:!0,timer:5e3}):(n=$("#etapa-actual").val(),location.href=`${BASE_URL}/api/reportes/Preparar-Nomina/${n}`)})});
//# sourceMappingURL=prepararNomina.min.js.map